{% extends 'partials/base.html' %}
{% block title %}Staff Detail Page{% endblock %}
{% block headers %} VIEW ACCOUNT {% endblock %}
{% load static %}
{% block content %}

<script type="text/javascript" defer>
    $(window).on('load', function() {
        $('.toast').toast();
        {% if messages %}
            $('.toast').show();
        {% endif %}
        {% block script %}
        
        {% endblock %}
    });

</script>

<div style="margin-top: 64px;" class="dark:white flex flex-col gap-3">
    <div class="animate fade-animator h-[auto] delay-1 bg-[#ff880000] overflow-hidden w-full rounded-[20px] min-h-[240px] flex flex-col text-center justify-center items-center font-sans">
        <div class="z-[0] h-[40vh] cover mix-blend-multiply saturate-0 w-full" style="mix-blend-mode: multiply;opacity:0.05;background:url('/static/images/bulsu_logo.png');background-size:cover; background-position: center;">
        </div>
        <div class="z-[1] absolute" style="width:80%">
            <div class="dark:white">
                <div class="flex justify-between">
                    <div class="grid grid-flow-col gap-4 items-center">
                        <div class="rounded-full" style="border-radius:100%;background-image: url('{{ user.profile.image.url }}');width:20vh;height:20vh;background-size: cover;"></div>
                        <div class="leading-[1] text-left">
                            {% if user_data %}
                            <h1 class="font-sans font-bold tracking-[-2px]">{{ user_data.0.first_name }} {{ user_data.0.last_name }}</h1>
                            <p class="capitalize opacity-50 text-sm mt-[-10px]">{{ user_data.0.user_role }}</p>
                            {% else %}
                            <h1 class="font-sans font-bold tracking-[-2px]">{{ user.first_name }} {{ user.last_name }}</h1>
                            <p class="capitalize opacity-50 text-sm mt-[-10px]">{{ user.user_role }}</p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="flex items-center gap-2 ">
                            {% if request.user.profile.user_role != 'faculty' %}
                            <div class="items-center dark:hover:bg-white dark:hover:text-black button-standard border border-[rgba(200,200,200,0.5)] px-2 py-1 rounded-md flex gap-2">
                                <img src="/static/images/add_user.png" class="dark:invert" style="height:14px;width:14px"/>
                                {% if user_data %}
                                <button class="copy" data-clipboard-text="http://127.0.0.1:8000/user/profile/{{ user_data.0.id }}">
                                    Share
                                {% else %}
                                <button class="copy" data-clipboard-text="http://127.0.0.1:8000/user/profile/{{ user.id }}">Share</button>
                                {% endif %}
                                </button>
                            </div>
                            {% endif %}
                            {% if view != 'outside' %}
                            <a class="form-modal-toggler main-theme-bg" title="Update Profile" href="javascript:void();" value="{% url 'user-profile-update' %}">Edit Profile</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        {% if view != 'outside' %}
        <div class="grid grid-flow-col gap-2 justify-center m-4">
            {% if request.user.profile.user_role != 'faculty' %}
            <a class="form-modal-toggler main-theme-bg" title="Add Post" href="javascript:void();" value="/announcements/add_announcements">Add Post</a>
            {% endif %}
            <a class="form-modal-toggler main-theme-bg" title="Add Research" href="javascript:void();" value="/research/add_research">Add Research</a>
        </div>
        {% endif %}
        {% if request.user.profile.user_role != 'faculty' %}
        <p class="text-center text-lg font-bold">Posts</p>
        <div class="grid gap-3 grid-cols-3 [&>div]:rounded-md w-full">
            {% if feeds.0|length > 0 %}
                {% for feed in feeds.0 %}
                    <div aria-expanded="false" aria-controls="drawer-name" data-drawer-trigger id="research-{{ research.id }}" class="trigger research-item flex flex-col justify-between max-h-[200px] bg-[#f5f5f5] dark:bg-[#363636] animate glow delay-{{forloop.counter}}" style="padding: 25px">
                        <div class="flex justify-between">
                            <p class="font-bold" style="font-weight:bold;font-size:20px; letter-spacing: -1px; line-height: 1">{{ feed.subject|slice:":50" }}</p>
                            {% if request.user.profile.user_role != 'faculty' %}
                            <div class="flex gap-3 items-center">
                                <p class="text-right text-sm">{{ feed.date_created|date:"M d, Y" }}</p>
                                <div class="transition dropdown">
                                    <button class="font-bold transition hover:opacity-[0.5]" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="transform: translateY(-13px);">...</button>
                
                                    <div class="p-3 dropdown-menu dropdown-menu-right" style="z-index:1000">                                                 
                                        <a class="form-modal-toggler bg-transparent border-0 text-black dark:white hover:main-theme font-bold dropdown-item p-2" title="Edit Post / Announcement" href="javascript:void();" value="/announcements/update/{{ feed.id }}">Edit</a>
                                        <div class="dropdown-divider"></div>    
                                        <a class="font-bold ignore-url dropdown-item p-2 bg-transparent" title="Edit Post / Announcement" href="/announcements/delete/{{ feed.id }}">Delete</a>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <p style="white-space:normal; max-height:70px; overflow:hidden; text-overflow:ellipsis; word-wrap: break-word">{{ feed.description }}</p>
                        </div>
                        <div class="flex justify-between">
                            <div class="flex gap-2">
                                {% for user in users %}
                                    {% if feed.user_id_id == user.id %}
                                        <img src="/media/{{ user.image }}" class="rounded-full" style="height:20px;width:20px"/>
                                        <p class="font-bold">{{ user.user.first_name }}  {{ user.user.last_name }}</p>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p class="px-2 py flex items-center" style="font-size:10px;border:1px solid #d59c31; color:#d59c31">Post</p>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        {% if feeds.0|length <= 0 %}
            <p class="text-center">No Data</p>    
        {% endif %}
    </div>
    {% endif %}
    <div>
        <p class="text-center text-lg font-bold">Researches</p>
        <div class="grid gap-3 grid-cols-3 [&>div]:rounded-md w-full">
            {% if researches.0|length > 0 %}
                {% for feed in researches.0 %}
                    <div aria-expanded="false" aria-controls="drawer-name" data-drawer-trigger id="research-{{ research.id }}" class="trigger research-item flex flex-col justify-between max-h-[200px] bg-[#f5f5f5] dark:bg-[#363636] animate glow delay-{{forloop.counter}}" style="padding: 25px">
                        <div class="flex justify-between">
                            <p class="font-bold" style="font-weight:bold;font-size:20px; letter-spacing: -1px; line-height: 1">{{ feed.research_title|slice:":50" }}</p>
                            {% if request.user.profile.user_role != 'faculty' %}
                            <div class="flex gap-3 items-center">
                                <p class="text-right text-sm">{{ feed.date_added|date:"M d, Y" }}</p>
                                <div class="transition dropdown">
                                    <button class="font-bold transition hover:opacity-[0.5]" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="transform: translateY(-13px);">...</button>
                
                                    <div class="p-3 dropdown-menu dropdown-menu-right" style="z-index:1000">                                                 
                                        <a class="form-modal-toggler bg-transparent border-0 text-black dark:white hover:main-theme font-bold dropdown-item p-2" title="Edit Research" href="javascript:void();" value="/research/update_research/{{ feed.id }}">Edit</a>
                                        <div class="dropdown-divider"></div>    
                                        <a class="font-bold ignore-url dropdown-item p-2 bg-transparent" title="Delete Research" href="/research/delete_research/{{ feed.id }}">Delete</a>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <p style="white-space:normal; max-height:70px; overflow:hidden; text-overflow:ellipsis; word-wrap: break-word">{{ feed.abstract }}</p>
                        </div>
                        <div class="flex justify-between">
                            <div class="flex gap-2">
                                {% for user in users %}
                                    {% if feed.user_id_id == user.id %}
                                        <img src="/media/{{ user.image }}" class="rounded-full" style="height:20px;width:20px"/>
                                        <p class="font-bold">{{ user.user.first_name }}  {{ user.user.last_name }}</p>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p class="px-2 py flex items-center" style="font-size:10px;border:1px solid #d59c31; color:#d59c31">{{ feed.research_progress }}</p>
                        </div>
                    </div>
                {% endfor %}   
            {% endif %}
        </div>
        {% if researches.0|length <= 0 %}
            <p class="text-center">No Data</p>    
        {% endif %}
    </div>

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} my-2 mx-4" role="alert">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

</div>
{% endblock %}